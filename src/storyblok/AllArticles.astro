---
import { storyblokEditable, useStoryblokApi } from '@storyblok/astro';
import PageTitle from '@components/PageTitle.astro';
import PostList from '@components/PostList.astro';
import TagList from '@components/TagList.astro';

const { blok } = Astro.props;

const storyblokApi = useStoryblokApi();

const { data } = await storyblokApi.get(`cdn/stories`, {
  version: import.meta.env.DEV ? 'draft' : 'published',
  starts_with: 'blog/',
  is_startpage: false,
  per_page: 4,
});

const articles = data.stories;
console.log(articles);

const tags = [
  ...new Set(articles.map((article: any) => article.content.tags).flat()),
];
---

<section
  class="mx-auto flex w-full flex-col gap-8 lg:gap-2"
  {...storyblokEditable(blok)}
>
  <PageTitle title={blok.headline} />
  <div class="flex flex-col lg:flex-row">
    <PostList articles={articles} />
    <TagList tags={tags} />
  </div>
</section>
