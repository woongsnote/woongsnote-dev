---
import PostLayout from '@/layouts/PostLayout.astro';
import { sortPostsByDateDesc } from '@/utils/content';
import type { GetStaticPaths } from 'astro';
import { getCollection, render } from 'astro:content';

export const getStaticPaths = (async () => {
  const posts = (await getCollection('blog')).sort(sortPostsByDateDesc);
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;

const slug = post.id;

const currentUrl = `${slug}`;

const ogImage = `${slug}/og.png`;

const {
  title,
  description,
  tags,
  category,
  cover,
  publishedDate,
  link,
  author,
} = post.data;

const { Content, headings, remarkPluginFrontmatter } = await render(post);

const isHeadings = (headings?.length ?? 0) > 0;

const minutesToRead = Number.parseInt(
  String(remarkPluginFrontmatter?.minutesRead ?? '').match(/\d+/)?.[0] ?? '0',
  10
);
const layoutProps = {
  title,
  description,
  tags,
  category,
  cover,
  isHeadings,
  publishedDate,
  minutesToRead,
  headings,
  ogImage,
  link,
  currentUrl,
  author,
};
---

<PostLayout {...layoutProps}>
  <Content />
</PostLayout>
