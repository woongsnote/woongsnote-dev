---
import PostLayout from '@/app/layouts/PostLayout.astro';
import { parseMinutes, sortPostsByDateDesc } from '@/shared/lib/content/posts';
import { seo } from '@/shared/lib/seo';
import { postToSeoSource } from '@/shared/lib/seo/adapter/post';
import type { GetStaticPaths } from 'astro';
import { getCollection, render } from 'astro:content';

export const getStaticPaths = (async () => {
  const posts = (await getCollection('posts')).sort(sortPostsByDateDesc);
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;

const meta = seo.post(postToSeoSource(post));

const { Content, headings, remarkPluginFrontmatter } = await render(post);

const readingTime = parseMinutes(remarkPluginFrontmatter.minutesRead);
---

<PostLayout
  meta={meta}
  post={post}
  headings={headings}
  readingTime={readingTime}
>
  <Content />
</PostLayout>
