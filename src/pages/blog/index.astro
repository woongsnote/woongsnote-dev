---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '@layouts/BaseLayout.astro';
import BlogHeader from '@components/Blog/BlogHeader.astro';
import YearSection from '@components/Blog/YearSection.astro';
import { sortPostsByDateDesc, filterPostsByYear } from '@utils/data-util';
import { BLOG } from '@config/site-config';
import type { PostsByYear } from '@utils/types';

const { title, description } = BLOG;

const allPosts: CollectionEntry<'blog'>[] = (await getCollection('blog')).sort(
  sortPostsByDateDesc
);

const postsByYear: PostsByYear = filterPostsByYear(allPosts);

const years: string[] = Object.keys(postsByYear).sort(
  (a, b) => parseInt(b) - parseInt(a)
);
---

<Layout title={title} description={description}>
  <BlogHeader />
  {years.map((year) => <YearSection year={year} posts={postsByYear[year]} />)}
</Layout>
