---
import { getCollection, type CollectionEntry } from 'astro:content';
import Article from '@layouts/Article.astro';
import { sortPostsByDateDesc } from '@utils/data-util';

export async function getStaticPaths() {
  const allPosts = (await getCollection('blog')).sort(sortPostsByDateDesc);

  return allPosts.map((entry) => ({
    params: { slug: entry.slug },
    props: { post: entry },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;

const { Content, headings, remarkPluginFrontmatter } = await post.render();

const { title, description, publishedDate, tags, cover, category } = post.data;
---

<Article
  title={title}
  description={description}
  publishedDate={publishedDate}
  tags={tags}
  minutesToRead={remarkPluginFrontmatter.minutesRead.split(' ')[0]}
  cover={cover}
  category={category}
  headings={headings}
>
  <Content />
</Article>
