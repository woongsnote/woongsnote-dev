---
import { useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import Base from '@layouts/Base.astro';

const storyblokAPi = useStoryblokApi();
const slug = Astro.params.slug;
let content;
try {
  const { data } = await storyblokAPi.get(`cdn/stories/blog/${slug}`, {
    version: import.meta.env.DEV ? 'draft' : 'published',
  });
  content = data.story.content;
} catch (error) {
  return Astro.redirect('/404');
}
---

<Base {...content}>
  <StoryblokComponent blok={content} />
</Base>
