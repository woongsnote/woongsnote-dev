---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import config from '@config/config.json';
import Base from '@layouts/Base.astro';
import Posts from '@layouts/Posts.astro';
import Pagination from '@components/Pagination.astro';
import PageHeader from '@components/PageHeader.astro';

export const prerender = true;

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getCollection('blog');
  const formattedPosts = posts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );
  return paginate(formattedPosts, { pageSize: config.site.pageSize });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const tags = [...new Set(page.data.map((post) => post.data.tags).flat())];
---

<Base title="Blog - woongsnote">
  <PageHeader
    title="Blog"
    description="학습한 지식들과 구현했던 프로젝트들에 대한 기록입니다."
  />
  <Posts posts={page.data} tags={tags} />
  <Pagination
    length={page.lastPage}
    currentUrl={page.url.current}
    currentPage={page.currentPage}
    firstUrl={`/blog/`}
    prevUrl={page.url.prev}
    nextUrl={page.url.next}
    lastUrl={`/blog/${page.lastPage}`}
  />
</Base>
