---
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogHeader from '@components/Blog/BlogHeader.astro';
import Categories from '@components/Blog/Categories.astro';
import PostList from '@components/Posts/PostList.astro';
import { BLOG, CATEGORIES as categories } from '@config/site-config';
import { generateYears, sortPostsByDateDesc } from '@utils/data-util';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = (await getCollection('blog')).sort(sortPostsByDateDesc);

  return categories.map(({ page }) => ({
    params: { page },
    props: {
      posts: page
        ? posts.filter((post: CollectionEntry<'blog'>) =>
            post.data.category.toLowerCase()?.includes(page)
          )
        : posts,
      currentPage: page,
    },
  }));
}

const { title, description } = BLOG;

const { posts, currentPage } = Astro.props;

const years = generateYears(posts);
---

<BaseLayout title={title} description={description}>
  <BlogHeader />
  <Categories currentPage={currentPage} />
  <PostList posts={posts} />
</BaseLayout>
