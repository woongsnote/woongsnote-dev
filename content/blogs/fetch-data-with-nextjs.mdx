---
title: Fetch Data with NextJs
description: NextJs로 API 데이터 fetching 하기
date: 2023-06-12
---


요즘 핫한, `NextJs`로  TMDB API에서 인기 영화 데이터를 `fetching`하는 예제를 만들어 보려고 한다.
영화 데이터를 가져올 때, 프레임워크 외에 `Axios`등의 추가적인 패키지를 설치하지 않고, NextJs 프레임워크의 fetch API만으로 구현하려고 한다.


1. 먼저 프로젝트를 만들어 준다.

```Terminal
npx create-next-app@latest
```

2. 프로젝트가 생성되면, 프로젝트에 사용할 `API Key`를 발급받아야 한다.

API Key 발급이 완료되면 모든 준비가 끝이 난다.
발급된 API Key는 루트 디렉토리에 `.env.local` 파일을 생성하고, `NEXT_PUBLIC_TMDB_API_KEY` 이름으로 넣어준다.
- NEXT_PUBLIC 이후는 원하는대로 작성해도 된다. [env 관련 NextJs 공식 문서](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)
- API key는 유출되면 안되므로, local에서만 볼 수 있어야 한다.

3. 이제 app 디렉토리의 page.tsx 파일로 이동해서 기존 내용을 지우고, 아래와 같이 작성해보자.

```tsx
// app/page.tsx
import Image from "next/image";

async function getPopularMovies() {
  const url =
    "https://api.themoviedb.org/3/movie/popular/?language=ko-KR&page=1&region=KR";
  const options = {
    method: "GET",
    headers: {
      accept: "application/json",
      Authorization: "Bearer " + process.env.NEXT_PUBLIC_TMDB_API_TOKEN,
    },
  };
  const res = await fetch(url, options);

  if (!res.ok) {
    throw new Error("Failed to Fetch Movie Data");
  }

  return res.json();
}

interface Movies {
  results: Movie[];
}

interface Movie {
  id: number;
  title: string;
  poster_path: string;
}

export default async function Home() {
  const data: Movies = await getPopularMovies();
  const popularMovies = data.results;
  return (
    <main>
      <h2 className="text-center text-4xl m-2">인기 있는 영화 목록</h2>
      <div className="grid grid-cols-4 m-4 gap-4">
        {popularMovies.map((movie: Movie) => (
          <div key={movie.id} className="rounded-xl p-2 overflow-hidden">
            <Image
              src={`https://image.tmdb.org/t/p/w500${movie.poster_path}`}
              alt={movie.title}
              width={700}
              height={700}
              className="rounded-xl"
            />
            <span>{movie.title}</span>
          </div>
        ))}
      </div>
    </main>
  );
}
```

※ NextJs에서 제공해주는 Image 컴포넌트에서 웹 이미지를 사용하려면 `next.config.js` 파일에 이미지 파일의 웹 주소 등록이 필요하다.

```js
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "image.tmdb.org",
        pathname: "/t/p/w500/*",
      },
    ],
  },
};
```

특별한 문제가 없다면 아래와 같이 영화 목록을 확인할 수 있다.


※ 해당 내용을 기반으로 기능을 추가해서 구현한 [프로젝트 링크](https://github.com/woongsnote/my-movie-recommend)
